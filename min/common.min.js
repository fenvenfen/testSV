var cropperApp = angular.module('svApp', [
    'ngRoute',
    'dataService',
    'personalInfoDirective',
    'summaryDataDirective'
])

cropperApp.config(function($routeProvider,$locationProvider) {
    $routeProvider
    .when("/", {
        templateUrl : "app/layout/home.html"
    })

    $locationProvider.hashPrefix('');
    $locationProvider.html5Mode(true)
    
});

cropperApp.controller('MainCtrl', ['$scope', '$http', 'personInfo', function ($scope, $http, personInfo) {
    console.log("MAIN CONTORLLER")
    $scope.titleOfMainPage = "My Personal Page";
    $scope.showCharts = false;
    //Get main data from json and send to save in service
    $http.get('../data.json').then(function (response) {
        personInfo.setInfoData(angular.copy(response.data))
    });

    $scope.openBlockCharts = function(){
        $scope.true = false;
    }

}]);

angular.module('personalInfoDirective', [])

    .directive('personalInfo', [ function () {
        var directive = {};

        directive.scope = {
            ghInfo: '='
        };

        directive.controller = ['$scope', 'personInfo', function ($scope, personInfo) {
            // Get data from service
            $scope.data = personInfo.getOriginaInfoData();
        }];

        directive.template = function() {
            return  `<h1 class="center">{{ghInfo}}<span class="badge badge-secondary">Test</span></h1>
                <div ng-repeat="(key, value) in data.sv.info">
                    <h5>{{key}}<span>  {{value}} </span></h5>
                </div>
            `
        }
        return directive
    }])
angular.module('summaryDataDirective', [
    'workDirective'
])

    .directive('summaryData', [ function () {
        return {
            scope: {},
            controller: ['$scope',  'personInfo', function ($scope, personInfo) {
                let data = personInfo.getOriginaInfoData();
                $scope.sum = data.sv.summary;
                $scope.edu = data.sv.education;
                $scope.experience = data.sv.experience;
            }],
            template: function () {
                return `<div>{{sum.mainInfo}}</div>
                <ul>
                    <li ng-repeat="education in edu">{{education}}</li>
                </ul>
                <work-experience></work-experience>`
            }
        }      
    }])
angular.module('workDirective', [])

    .directive('workExperience', [ function () {
        return {
            controller: ['$scope', 'personInfo', function ($scope, personInfo) {
                console.log($scope)
            }],
            template: function () {
                return `
                <ul>
                    <li ng-repeat="exp in experience | orderBy:$index:true">{{exp.title}} <span class="badge badge-secondary">{{exp.position}}</span>
                        <div>
                            <p class="badge badge-secondary">{{exp.date}}</p>
                            <p>{{exp.about}}</p>
                        </div>
                    </li>
                </ul>`
            }
        }      
    }])
angular.module('dataService', [])
    .service('personInfo', function(){
        // Service data
        let originalData = [];

        this.setInfoData = function(data){
            originalData = data;
        }
        this.getOriginaInfoData = function(){
            return originalData;
        }
    })